# PTIA: Progressive Temporal Inter-Frame Alignment Towards Compressed Video Super-Resolution

## Introduction

In this paper, we propose a novel framework termed Progressive Temporal Inter-Frame Alignment (PTIA), which integrates video quality enhancement with video super-resolution specifically for compressed videos. 
The PTIA framework begins with the introduction of an implicit multi-granularity compression representation module (MGCR), which adaptively identifies varying levels of compression. The compression-aware features generated by this module are subsequently input into the Temporal Bidirectional Inter-Frame Alignment module (TBIA). The TBIA leverages residual flow, computed using a differentiable adaptive deformable convolution network (AdaDCN), to progressively refine the estimated motion.
To further enhance the final super-resolution output, PTIA employs a cross-attention fusion scheme (CAFS), enabling effective interaction between aligned features and multi-scale adjacent features, thereby facilitating the integration of spatio-temporal information. Extensive empirical evaluations demonstrate that the proposed PTIA framework outperforms state-of-the-art methods in compressed VSR tasks on videos encoded with H.264 and H.265 codecs.


### Demo Videos 
Vid4 calender (CRF=15)

Vid4 city (CRF=25)


BasketballDrill (QP=22)


KristenAndSara (QP=37)


## Getting Started


### Installation

  ```bash
  pip install -r requirements.txt
  ```
### Data preparation
1. REDS datasets can be downloaded at the link:(https://seungjunnah.github.io/Datasets/gopro)
2. Vimeo90K dataset can be downloaded at the link:(http://toflow.csail.mit.edu/)
3. Vid4 dataset can be downloaded at the link:(http://toflow.csail.mit.edu/)
4. CVCP dataset can be downloaded at the link:()
5. 18 testing sequences can be downloaded at the link: (https://www.dropbox.com/scl/fo/7xdst5brdy9ppykp9ohcj/AAaNkDyH0vyY7Ecd7UEsCXw?rlkey=c2v7we4n1q13kwrx23l3tmeaa&e=2&dl=0) (Provided by MFQE2.0) 
6. Please downsample the frames with the matlab script in degradation/BI_degradation.m for BI downsampling (REDS, CVCP, 18 testing sequences) and degradation/BI_degradation.m for BD downsampling (Vimeo90K, Vid4)
7. We apply FFMPEG for H.264 codec and HM16.19 for HEVC codec (https://vcgit.hhi.fraunhofer.de/jvet/HM/-/tree/HM-16.19/build).

### Evaluation
1. Copy the [dataset]() and [checkpoints]() to the workplace. 
2. Run scripts:
    ```bash
    python basicsr/test.py   -opt script/test_Vid4_BD.yml
    ```

## License

All assets and code are under the [Apache 2.0 license](./LICENSE) unless specified otherwise.
